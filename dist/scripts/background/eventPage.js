var r=/:\/\/(.[^/]+)/,prevWebsite='',myURL='about:blank',msgs='';console.log('start');var creds,newsKeys,URL=chrome.extension.getURL('../../common/news_websites.json'),request=new XMLHttpRequest;if(request.open('GET',URL,!1),request.send(null),200===request.status)msgs=JSON.parse(request.responseText);chrome.storage.sync.get('diiKeys',function(e){console.log('Old Keys:'),console.log(e),creds=e.diiKeys;}),chrome.storage.sync.get('newsKeys',function(e){console.log('Old Keys:'),console.log(e),newsKeys=e.newsKeys;});var websites=msgs.Website,domainsList=msgs.Domain,comments=msgs.Comments,newsOriginContextMenu={id:'SsSorigin',title:'Get probable News ',contexts:['selection']},diiContextMenu={id:'diiMenu',title:'Check image for disinformation',contexts:['image']},fnContextMenu={id:'fnMenu',title:'Check for Fake News',contexts:['link','selection']};function dii(e){console.log(e.srcURL);}function checkWebsite(e){if(prevWebsite!==e){console.log('visiting: '+e);for(var t=0;t<1964;t++)if(e===domainsList[t]||e.includes(domainsList[t])||domainsList[t].includes(e)){var s={type:'basic',title:'Webite Info: '+websites[t],message:'Comments: '+comments[t],iconUrl:'../../assets/icon/72.png'};chrome.notifications.create(s);break;}}prevWebsite=e;}chrome.contextMenus.create(newsOriginContextMenu),chrome.contextMenus.create(diiContextMenu),chrome.contextMenus.create(fnContextMenu),chrome.contextMenus.onClicked.addListener(function(e){if('SsSorigin'===e.menuItemId&&e.selectionText){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(t.responseText),s=e.HIGH,o={type:'basic',title:'Origin probabilities: ',message:'High:'+s+', SOME: '+e.SOME,expandedMessage:'High'+e.MINIMAL,iconUrl:'../../assets/icon/72.png'};console.log(s),chrome.notifications.create(o);}},chrome.storage.sync.get('newsKeys',function(e){console.log('Old Keys:'),console.log(e),newsKeys=e.newsKeys;}),t.open('GET','https://phcg4hgf84.execute-api.us-east-1.amazonaws.com/dev/pred?text='+e.selectionText+'&key='+newsKeys,!0),t.send();}if('diiMenu'===e.menuItemId){var s=e.srcUrl;console.log(e.srcUrl);new URLSearchParams;var o={method:'GET',redirect:'follow'};console.log(creds),chrome.storage.sync.get('diiKeys',function(e){console.log('Old Keys:'),console.log(e),creds=e.diiKeys;}),fetch('https://j9sgfnzwo8.execute-api.us-east-1.amazonaws.com/dev/lookup/?creds='+creds+'&link='+s,o).then(e=>e.text()).then(result=(e=>{console.log('result'+e),chrome.windows.create({url:'scripts/content/dii/diiResult.html?api=dii&imgsrc='+btoa(s)+'&result='+btoa(e),focused:!0,type:'popup'});})).catch(error=(e=>{console.log('error',e);}));}if('fnMenu'===e.menuItemId)if(url=e.linkUrl,url){src='newsWeb',(n=new Headers).append('Content-Type','application/json');o={method:'POST',headers:n,body:'{"source": "newsWeb","body":{"link":"'+url+'"}}',redirect:'follow'};fetch('https://59rfocmnrd.execute-api.us-east-1.amazonaws.com/dev/predict',o).then(e=>e.text()).then(result=(e=>{console.log('result'+e),chrome.windows.create({url:'scripts/content/dii/fnResult.html?api=fn&src='+btoa(url)+'&result='+btoa(e),focused:!0,type:'popup'});})).catch(e=>console.log('error',e));}else{var n;(n=new Headers).append('Content-Type','application/json');o={method:'POST',headers:n,body:JSON.stringify({source:'FB',body:{content:e.selectionText}}),redirect:'follow'};fetch('https://59rfocmnrd.execute-api.us-east-1.amazonaws.com/dev/predict',o).then(e=>e.text()).then(result=(t=>{console.log('result'+t),chrome.windows.create({url:'scripts/content/dii/fnResult.html?api=fn&src='+btoa(e.selectionText)+'&result='+btoa(t),focused:!0,type:'popup'});})).catch(e=>alert('error',e));}}),chrome.tabs.onUpdated.addListener(function(e,t,s){chrome.tabs.getSelected(null,function(e){myURL=e.url,k=myURL,k=myURL.match(r)[1],myWebsite=k.replace(/^(https?:\/\/)?(www\.)?/,''),checkWebsite(myWebsite),chrome.storage.sync.set({website:myWebsite});});});